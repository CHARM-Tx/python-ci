name: Python Lint

on:
  workflow_call:
    inputs:
      module_name:
        type: string
        description: the name of the source code module to document
        required: true

jobs:
  python-lint:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    steps:
      - uses: actions/checkout@v2

      - uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - run: python -m pip install pdoc

      - name: Generate documentation
        run: pdoc ${{ inputs.module_name }} --docstyle google --output-directory html_docs

      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: eu-central-1

      - name: Upload to s3 (dry run)
        run: |
          VERSION=${{ github.ref_name }}
          echo $VERSION
          aws s3 sync --dryrun html_docs/ s3://charmtx-python-doc/${{inputs.module_name}/${VERSION}/

      - name: Upload to s3 (dry run)
        run: |
          VERSION=${{ github.ref_name }}
          echo $VERSION
          aws s3 sync html_docs/ s3://charmtx-python-doc/${{inputs.module_name}/${VERSION}/
        if: startsWith(github.ref, 'refs/tags/v')
